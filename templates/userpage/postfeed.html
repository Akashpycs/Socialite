{% extends 'base.html' %}
{% load static %}


{% block head_content %}
<link rel="stylesheet" href="{% static 'userpage/zuck.js-master/demo/style.css' %}">

<!-- lib styles -->
<link rel="stylesheet" href="{% static 'userpage/zuck.js-master/dist/zuck.min.css' %}">

<!-- lib skins -->
<link rel="stylesheet" href="{% static 'userpage/zuck.js-master/dist/skins/snapgram.css' %}">
{% endblock head_content %}

{% block nav_btn1 %}
    <button type="button" class="btn btn-outline-primary ml-4" data-toggle="modal" data-target="#PostModal">
      Post
    </button>
{% endblock nav_btn1 %}

{% block css %}

    #post_img
    {
        width:460;
        heigt:360;
    }

    .post_div
    {
        width:535px;
    }

{% endblock css %}


{% block body %}

<div id="stories" class="storiesWrapper"></div>

{% for i in posts %}
<div class='container my-4 post_div' id="{{ i.id }}">
  <div class="card">
    <h5 class="card-header">
      <a href="{% url 'userprofile' i.user %}" style="color:black;">{{i.user}}</a>
      <small>{{i.date.date}}</small>
    </h5>
    <div class="card-body">
      <p class="card-text">{{i.caption}}</p>
      {% if i.image %}
      <img src="{{i.image.url}}" alt="Image" id='post_img'>
      {% endif %}
      <hr size='30px'>

      <button class="btn btn-light mr-3 like" id="{{ i.id }}">
        {% if i in liked_post %}
        <a href="{% url 'like_dislike_post' %}" style="color:red;" id="likebtn{{ i.id }}"> Liked </a>
        {% else %}
        <a href="{% url 'like_dislike_post' %}" style="color:red;" id="likebtn{{ i.id }}"> Like </a>
        {% endif %}
      </button>

      <a role = "button" class="btn btn-warning mx-2" href = {% url 'comment' %}>Comment</a>

      <button  class="btn btn-info mx-4" > Repost </button>
      {% if request.user == i.user %}
      <a class="btn btn-danger ml-4 delete" href="{% url 'delpost' i.id %}" id="{{ i.id }}">Delete</a>
      {% endif %}
    </div>
  </div>
</div>
{% endfor %}


{% endblock body %}

{% block modals %}

<!-- Modal -->
<div class="modal fade" id="PostModal" tabindex="-1" role="dialog" aria-labelledby="PostModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="PostModalLabel">Show Time</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="/userpage/post" method="POST"  enctype="multipart/form-data">
          {% csrf_token %}
          <label for="image">Image : </label>
          <input type="file" name="image" id="image">
          <br><br><br>
          <label for="captions">Captions : </label>
          <br>
          <textarea name="captions" id="captions" cols="55" rows="10" placeholder="Oohlala..." class='ml-4'></textarea>
          <hr size='30'>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Let's Show</button>
        </form>
      </div>
    </div>
  </div>
</div>



{% endblock modals %}

{% block js %}
<script>
  $(".delete").click(function (e) {
    var id = this.id;
    var href = this.href;
    console.log(href, id) // get href from link
    e.preventDefault(); // don't follow the link

    $.ajax({
      url: href,
      data: {},
    });

    $("#" + id).fadeOut(1000);

  });

  $(".like").click(function (e) {
    var id = this.id; //$(this).attr('id');
    var href = $('.like').find('a').attr('href');
    console.log(href, id) // get href from link
    e.preventDefault(); // don't follow the link

    $.ajax({
        url: href,
        data: {
          'likeId': id
        },
        success: function(response){
          if(response.liked){
            $('#likebtn' + id).html("Liked");
          }
          else{
            $('#likebtn' + id).html("Like");
          }
        }
      })
  });
  /* p ; {  * " :  [*/
</script>

<script src="{% static 'userpage/zuck.js-master/dist/zuck.min.js' %}"></script>
<script src="{% static 'userpage/zuck.js-master/demo/script.js' %}"></script>

{% endblock js %}
